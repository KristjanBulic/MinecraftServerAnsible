---
- name: dnf update cache and all packages
  dnf:
    name: "*"
    update_cache: yes
    state: latest
  become: true
  tags:
    - system
    - never

- name: Install required packages
  dnf:
    name:
      - java-11-openjdk-devel
      - screen
  become: true
  tags: minecraft

- name: Open port 25565
  firewalld:
    port: "25565/tcp"
    permanent: true
    state: enabled
    immediate: yes
    notify: firewall reload
    become: true
    tags: nginx

- name: Download minecraft server
  get_url:
    url: https://launcher.mojang.com/v1/objects/a16d67e5807f57fc4e550299cf20226194497dc2/server.jar
    dest: /opt/minecraft

- name: Accept eula
  replace:
    path: /opt/minecraft/eula.txt
    regexp: 'eula=false'
    replace: 'eula=true'
  become_user: minecraft
  become: true

- name: Start screen
  command: screen -S "Minecraft server"
  tags: minecraft

- name: Start server
  command: java -Xmx1024M -Xms1024M -jar /opt/minecraft/minecraft_server.1.17.1.jar nogui

